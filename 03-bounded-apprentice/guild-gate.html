<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guild Gate</title>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0a; overflow: hidden; font-family: 'Helvetica Neue', sans-serif; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5vw;
            font-weight: 900;
            color: #fff;
            letter-spacing: 1.5vw;
            text-transform: uppercase;
            font-family: 'Helvetica', sans-serif;
            opacity: 0;
            clip-path: inset(0 100% 0 0);
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="title">GUILD GATE</div>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const titleEl = document.getElementById('title');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        let startTime = null;
        let audioStarted = false;
        
        // Elevator ding
        const ding = new Tone.MetalSynth().toDestination();
        ding.volume.value = -10;
        
        // Security beeps
        const beep = new Tone.Synth({ oscillator: { type: 'square' }}).toDestination();
        beep.volume.value = -15;
        
        // Bass drone
        const drone = new Tone.Synth({ 
            oscillator: { type: 'sawtooth' },
            envelope: { attack: 2, sustain: 1, release: 2 }
        }).toDestination();
        drone.volume.value = -12;
        
        document.body.addEventListener('click', async () => {
            if (!audioStarted) {
                await Tone.start();
                startTime = Date.now();
                audioStarted = true;
                
                // Elevator ding
                ding.triggerAttackRelease('E5', '0.3', 0.5);
                
                // Security beeps cutting syllables
                [2, 2.3, 2.8, 3.1, 3.6, 4.2, 4.5].forEach(time => {
                    setTimeout(() => beep.triggerAttackRelease('C5', '0.05'), time * 1000);
                });
                
                // Unresolved bass drone
                setTimeout(() => drone.triggerAttack('A1'), 3000);
                
                animate();
            }
        });
        
        // ID Badges
        const badges = Array(50).fill().map((_, i) => ({
            x: (i % 10) * (canvas.width / 10) + canvas.width / 20,
            y: Math.floor(i / 10) * 150 + 100,
            rotation: 0,
            text: i === 25 ? 'NOT AUTHORIZED' : `ID ${1000 + i}`,
            isTarget: i === 25
        }));
        
        let cameraZ = -500;
        
        function drawHallway(t) {
            // Perspective push
            cameraZ = -500 + t * 100;
            
            // Hallway lines
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            for (let i = 0; i < 20; i++) {
                const z = i * 100 + (t * 50) % 100;
                const scale = 500 / (z - cameraZ);
                
                if (scale > 0 && scale < 10) {
                    const size = 400 * scale;
                    ctx.strokeRect(
                        canvas.width / 2 - size / 2,
                        canvas.height / 2 - size / 2,
                        size,
                        size
                    );
                }
            }
            
            // Rotating ID badges
            badges.forEach(badge => {
                badge.rotation += 0.02;
                
                const perspective = 1 - (badge.y / canvas.height) * 0.5;
                const scale = perspective * (1 + cameraZ / 1000);
                
                if (scale > 0) {
                    ctx.save();
                    ctx.translate(badge.x, badge.y);
                    ctx.rotate(badge.rotation);
                    ctx.scale(scale, scale);
                    
                    // Badge rectangle
                    const badgeW = 80;
                    const badgeH = 120;
                    ctx.fillStyle = badge.isTarget ? '#ffcc00' : '#555';
                    ctx.fillRect(-badgeW / 2, -badgeH / 2, badgeW, badgeH);
                    
                    // Text
                    ctx.fillStyle = '#000';
                    ctx.font = `bold ${badge.isTarget ? 10 : 12}px Helvetica`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const words = badge.text.split(' ');
                    words.forEach((word, i) => {
                        ctx.fillText(word, 0, -10 + i * 15);
                    });
                    
                    ctx.restore();
                }
            });
        }
        
        function drawVoiceGlitches(t) {
            if (t < 2 || t > 5) return;
            
            // Flickering syllables
            const syllables = ['HEL', 'LO', 'I', 'NEED', 'TO', 'SPE', 'AK'];
            const idx = Math.floor((t - 2) * 2.5) % syllables.length;
            
            if (Math.random() > 0.5) {
                ctx.fillStyle = 'rgba(255,255,255,0.7)';
                ctx.font = 'bold 40px Courier';
                ctx.textAlign = 'center';
                ctx.fillText(syllables[idx], canvas.width / 2, canvas.height * 0.8);
            }
        }
        
        function updateTitle(t) {
            if (t > 6) {
                const progress = Math.min(1, (t - 6) / 2);
                titleEl.style.opacity = 1;
                titleEl.style.clipPath = `inset(0 ${100 - progress * 100}% 0 0)`;
            }
        }
        
        function animate() {
            if (!startTime) return;
            const elapsed = (Date.now() - startTime) / 1000;
            if (elapsed > 8) return;
            
            ctx.fillStyle = '#0a0a0a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawHallway(elapsed);
            drawVoiceGlitches(elapsed);
            updateTitle(elapsed);
            
            requestAnimationFrame(animate);
        }
        
        ctx.fillStyle = '#ffcc00';
        ctx.font = '20px Helvetica';
        ctx.textAlign = 'center';
        ctx.fillText('CLICK TO START', canvas.width / 2, canvas.height / 2);
    </script>
</body>
</html>
